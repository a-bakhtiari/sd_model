<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SD Model UI</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; }
      .row { margin-bottom: 1rem; }
      select, input, button { font-size: 1rem; padding: 0.4rem; }
      pre { background: #f7f7f9; padding: 0.75rem; border-radius: 6px; }
      .muted { color: #666; }
    </style>
  </head>
  <body>
    <h1>System Dynamics Model â€“ Pipeline</h1>
    <div class="row">
      <label for="project">Project:</label>
      <select id="project"></select>
      <button id="runBtn">Run</button>
    </div>
    <div class="row">
      <div id="status" class="muted">Idle</div>
    </div>
    <div class="row">
      <h3>Artifacts</h3>
      <ul id="artifacts"></ul>
    </div>

    <script>
      async function fetchProjects() {
        const res = await fetch('/projects');
        const data = await res.json();
        const sel = document.getElementById('project');
        sel.innerHTML = '';
        for (const p of data.projects) {
          const opt = document.createElement('option');
          opt.value = p; opt.innerText = p; sel.appendChild(opt);
        }
      }

      async function listArtifacts(project) {
        const res = await fetch(`/artifacts/${project}`);
        const data = await res.json();
        const ul = document.getElementById('artifacts');
        ul.innerHTML = '';
        for (const f of data.files) {
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = `/artifacts/${project}/${f}`; a.innerText = f; a.target = '_blank';
          li.appendChild(a); ul.appendChild(li);
        }
      }

      document.getElementById('runBtn').addEventListener('click', async () => {
        const project = document.getElementById('project').value;
        document.getElementById('status').innerText = 'Running...';
        const res = await fetch(`/run-pipeline/${project}`);
        const data = await res.json();
        if (data.status === 'ok') {
          document.getElementById('status').innerText = 'Done';
          listArtifacts(project);
        } else {
          document.getElementById('status').innerText = 'Error: ' + data.error;
        }
      });

      fetchProjects().then(() => {
        const sel = document.getElementById('project');
        if (sel.options.length > 0) {
          listArtifacts(sel.value);
        }
      });
    </script>
  </body>
  </html>

